#!/bin/sh

string=
while getopts s: name
do
    case $name in
    s)    string="$OPTARG"
					;;
    esac
done
shift $(($OPTIND - 1))

[ -z "$string" ] && string=$1
cmd="$*"
con_id=

get_id()
{
  con_id="$(swaymsg -t get_tree | jq '
    first(recurse((.nodes + .floating_nodes)[]) |
    select(any(
    .window_properties.class,
    .window_properties.instance,
    .window_properties.window_role,
    .window_properties.title,
    .name,
		.title,
    .app_id;
    values and match("'"${string}"'"; "i")
    )).id)')"
}

get_id
if [ -n "${con_id:-}" ]; then 
	swaymsg "[con_id=${con_id%% }]" focus
else 
  $cmd &
  while [ -z "${con_id:-}" ]; do 
		get_id
	done
	swaymsg "[con_id=${con_id%% }]" focus
fi
killall wm_open
